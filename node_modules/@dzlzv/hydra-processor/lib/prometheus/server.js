"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.startPromEndpoint = void 0;
const express = require("express");
const prom_client_1 = require("prom-client");
function startPromEndpoint() {
    const server = express();
    // Setup server to Prometheus scrapes:
    server.get('/metrics', (req, res) => {
        try {
            res.set('Content-Type', prom_client_1.register.contentType);
            res.end(prom_client_1.register.metrics());
        }
        catch (ex) {
            res.status(500).end(ex);
        }
    });
    server.get('/metrics/:metricName', (req, res) => {
        try {
            res.set('Content-Type', prom_client_1.register.contentType);
            if (!req.params.metricName ||
                !prom_client_1.validateMetricName(req.params.metricName)) {
                res.status(400).end('No requested metric found');
            }
            res.end(prom_client_1.register.getSingleMetricAsString(req.params.metricName));
        }
        catch (ex) {
            res.status(500).end(ex);
        }
    });
    const port = process.env.PROMETHEUS_PORT || 3000;
    console.log(`Server listening to ${port}, metrics exposed on /metrics endpoint`);
    server.listen(port);
}
exports.startPromEndpoint = startPromEndpoint;
//# sourceMappingURL=server.js.map